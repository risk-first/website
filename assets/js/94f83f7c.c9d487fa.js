"use strict";(self.webpackChunkrf_website=self.webpackChunkrf_website||[]).push([[9175],{381:(e,i,t)=>{t.d(i,{A:()=>s});const s=t.p+"assets/images/cap-cp-292ef5446285aa2dfb4cd223098ee830.svg"},28453:(e,i,t)=>{t.d(i,{R:()=>a,x:()=>r});var s=t(96540);const n={},o=s.createContext(n);function a(e){const i=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function r(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),s.createElement(o.Provider,{value:i},e.children)}},67319:(e,i,t)=>{t.d(i,{A:()=>s});const s=t.p+"assets/images/cap-ap-05f8aa8a8653fb780092e290d98dc5e4.svg"},83372:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>h,contentTitle:()=>r,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"risks/Coordination-Risk/CAP-Theorem","title":"CAP Theorem","description":"Imagine talking to a distributed database, where your request (read or write) can be handled by one of many agents.","source":"@site/docs/risks/Coordination-Risk/CAP-Theorem.md","sourceDirName":"risks/Coordination-Risk","slug":"/risks/CAP-Theorem","permalink":"/risks/CAP-Theorem","draft":false,"unlisted":false,"editUrl":"https://github.com/risk-first/website/blob/master/docs/risks/Coordination-Risk/CAP-Theorem.md","tags":[{"inline":false,"label":"Coordination Risk","permalink":"/tags/Coordination-Risk"}],"version":"current","sidebarPosition":3,"frontMatter":{"title":"CAP Theorem","sidebar_position":3,"slug":"/risks/CAP-Theorem","tags":["Coordination Risk"]},"sidebar":"tutorialSidebar","previous":{"title":"Decision Making","permalink":"/risks/Decision-Making"},"next":{"title":"Environmental Risks","permalink":"/risks/Environmental-Risks"}}');var n=t(74848),o=t(28453);const a={title:"CAP Theorem",sidebar_position:3,slug:"/risks/CAP-Theorem",tags:["Coordination Risk"]},r=void 0,h={},l=[{value:"With an AP System",id:"with-an-ap-system",level:2},{value:"With an CP System",id:"with-an-cp-system",level:2},{value:"With an CA System",id:"with-an-ca-system",level:2},{value:"Some Real-Life Examples",id:"some-real-life-examples",level:2},{value:"ZooKeeper",id:"zookeeper",level:3},{value:"Git",id:"git",level:3},{value:"Bitcoin",id:"bitcoin",level:3},{value:"Communication Is For Coordination",id:"communication-is-for-coordination",level:2}];function d(e){const i={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(i.p,{children:["Imagine talking to a distributed database, where your request (",(0,n.jsx)(i.em,{children:"read"})," or ",(0,n.jsx)(i.em,{children:"write"}),") can be handled by one of many agents."]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"User A and User B are both using a distributed database, managed by Agents 1 and 2, whom each have their own Internal Model",src:t(95632).A+"",width:"1066",height:"422"})}),"\n",(0,n.jsxs)(i.p,{children:["In the diagram above, we have just two agents ",(0,n.jsx)(i.code,{children:"1"})," and ",(0,n.jsx)(i.code,{children:"2"}),", in order to keep things simple.  ",(0,n.jsx)(i.code,{children:"User A"})," ",(0,n.jsx)(i.em,{children:"writes something"})," to the database, then ",(0,n.jsx)(i.code,{children:"User B"})," ",(0,n.jsx)(i.em,{children:"reads it back"})," afterwards."]}),"\n",(0,n.jsxs)(i.p,{children:["According to the ",(0,n.jsx)(i.a,{href:"https://en.wikipedia.org/wiki/CAP_theorem",children:"CAP Theorem"}),", there are three properties we could desire in such a system:"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Consistency (C)"}),": Every read receives the most recent value from the last write."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Availability (A)"}),": Every request receives a response."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Partition tolerance (P)"}),": The system can operate despite the isolation (lack of communication with) some of its agents."]}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:["The ",(0,n.jsx)(i.a,{href:"https://en.wikipedia.org/wiki/CAP_theorem",children:"CAP Theorem"})," states that this is a ",(0,n.jsx)(i.a,{href:"https://en.wikipedia.org/wiki/Trilemma",children:"Trilemma"}),".  That is, you can only have two out of the three properties."]}),"\n",(0,n.jsxs)(i.p,{children:["There are plenty of resources on the Internet that discuss this in depth, but let's just illustrate with some diagrams to show how this plays out.  In the diagram above, we can see a 2-agent distributed database.   Either agent can receive a read or write.  So this might be a ",(0,n.jsx)(i.strong,{children:"GII"})," decision making system, because all the agents are going to need to coordinate to figure out what the right value is to return for a read, and what the last value written was."]}),"\n",(0,n.jsxs)(i.p,{children:["In the above diagram, you can already see that there is a ",(0,n.jsx)(i.em,{children:"race condition"}),":  if A and B both make their requests at the same time, what will B get back?   The original value of X, or the new value?"]}),"\n",(0,n.jsx)(i.h2,{id:"with-an-ap-system",children:"With an AP System"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"In an AP system, the User B may get back a stale value for X",src:t(67319).A+"",width:"1066",height:"422"})}),"\n",(0,n.jsxs)(i.p,{children:["Here, we are going to consider what happens when communication breaks down between Agents 1 and 2.  That is, they are ",(0,n.jsx)(i.em,{children:"isolated"})," from communicating with each other.  As shown in the above diagram, in an ",(0,n.jsx)(i.code,{children:"AP"})," system, we have a database that is able to survive partitioning, and always returns a response, but may not be consistent.  The value ",(0,n.jsx)(i.code,{children:"B"})," will get back will depend on whether they talk with Agent 1 or Agent 2."]}),"\n",(0,n.jsx)(i.h2,{id:"with-an-cp-system",children:"With an CP System"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.img,{alt:"In an CP system, the User B won&#39;t get anything back for X, because Agent 2 can&#39;t be sure it has the latest value",src:t(381).A+"",width:"1066",height:"422"}),"."]}),"\n",(0,n.jsxs)(i.p,{children:["To be consistent, Agent 2 needs to check with Agent 1 to make sure it has the latest value for X.  Where Agent 2 is left waiting for Agent 1 to re-appear, we are ",(0,n.jsx)(i.em,{children:"blocked"}),".  So CP systems will block when partitioned."]}),"\n",(0,n.jsx)(i.h2,{id:"with-an-ca-system",children:"With an CA System"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{alt:"In an CA system, we can&#39;t have partition tolerance, so in order to be consistent a single Agent has to do all the work",src:t(95052).A+"",width:"1066",height:"668"})}),"\n",(0,n.jsxs)(i.p,{children:["Finally, if we have a CA system, we are essentially saying that ",(0,n.jsx)(i.em,{children:"only one agent is doing the work"}),".  (You can't partition a single agent, after all).  But this leads to ",(0,n.jsx)(i.a,{href:"https://en.wikipedia.org/wiki/Resource_allocation",children:"Resource Allocation"})," and ",(0,n.jsx)(i.strong,{children:"Contention"})," around use of the scarce resource of ",(0,n.jsx)(i.code,{children:"Agent 2"}),"'s attention. (Both ",(0,n.jsx)(i.a,{href:"/tags/Coordination-Risk",children:"Coordination Risk"})," issues we met earlier.)"]}),"\n",(0,n.jsx)(i.h2,{id:"some-real-life-examples",children:"Some Real-Life Examples"}),"\n",(0,n.jsxs)(i.p,{children:["This sets a lower bound on ",(0,n.jsx)(i.a,{href:"/tags/Coordination-Risk",children:"Coordination Risk"}),":  we ",(0,n.jsx)(i.em,{children:"can't"})," get rid of it completely in a software system, -or- a system on any other scale. Fundamentally, coordination problems are inescapable at some level.  The best we can do is mitigate it by agreeing on protocols and doing lots of communication."]}),"\n",(0,n.jsx)(i.p,{children:"Let's look at some real-life examples of how this manifests in software."}),"\n",(0,n.jsx)(i.h3,{id:"zookeeper",children:"ZooKeeper"}),"\n",(0,n.jsxs)(i.p,{children:["First, ",(0,n.jsx)(i.a,{href:"https://zookeeper.apache.org",children:"ZooKeeper"})," is an Open-Source datastore, which is used in building distributed systems (like the one above) and ensuring things like configuration information are consistent across all agents."]}),"\n",(0,n.jsxs)(i.p,{children:["This ",(0,n.jsx)(i.em,{children:"seems"})," trivial, but it quickly gets out-of-hand:  what happens if only some of the agents receive the new information? What happens if a datacentre gets disconnected while the update is happening?  There are lots of edge-cases."]}),"\n",(0,n.jsxs)(i.p,{children:["ZooKeeper handles this by communicating inter-agent with its own protocol.  It elects a ",(0,n.jsx)(i.strong,{children:"master agent"})," (via ",(0,n.jsx)(i.strong,{children:"GII"}),"-style voting), turning it into an ",(0,n.jsx)(i.strong,{children:"AI"}),"-style team.  If the master is lost for some reason, a new leader is elected.  ",(0,n.jsx)(i.em,{children:"Writes"})," are then coordinated via the ",(0,n.jsx)(i.strong,{children:"master agent"})," who makes sure that a ",(0,n.jsx)(i.em,{children:"majority of agents"})," have received and stored the configuration change before telling the user that the transaction is complete.  Therefore, ZooKeeper is a ",(0,n.jsx)(i.code,{children:"CP"})," system."]}),"\n",(0,n.jsx)(i.h3,{id:"git",children:"Git"}),"\n",(0,n.jsxs)(i.p,{children:["Second, ",(0,n.jsx)(i.a,{href:"https://en.wikipedia.org/wiki/Git",children:"Git"})," is a (mainly) write-only ledger of source changes.  However, as we already discussed above, where different agents make incompatible changes, someone has to decide how to resolve the conflicts so that we have a single source of truth."]}),"\n",(0,n.jsxs)(i.p,{children:["The ",(0,n.jsx)(i.a,{href:"/tags/Coordination-Risk",children:"Coordination Risk"})," just ",(0,n.jsx)(i.em,{children:"doesn't go away"}),"."]}),"\n",(0,n.jsxs)(i.p,{children:["Since multiple users can make all the changes they like locally, and merge them later, Git is an ",(0,n.jsx)(i.code,{children:"AP"})," system where everyone's opinion counts (",(0,n.jsx)(i.strong,{children:"GII"}),"):  individual users may have ",(0,n.jsx)(i.em,{children:"wildly"})," different ideas about what the source looks like until the merge is complete."]}),"\n",(0,n.jsx)(i.h3,{id:"bitcoin",children:"Bitcoin"}),"\n",(0,n.jsxs)(i.p,{children:["Finally, ",(0,n.jsx)(i.a,{href:"https://en.wikipedia.org/wiki/Bitcoin",children:"Bitcoin (BTC)"})," is a write-only ",(0,n.jsx)(i.a,{href:"https://en.wikipedia.org/wiki/Distributed_ledger",children:"distributed ledger"}),", where agents ",(0,n.jsx)(i.em,{children:"compete"})," to mine BTC (a ",(0,n.jsx)(i.strong,{children:"UI"})," style organisation), but also at the same time record transactions on the ledger.  BTC is also ",(0,n.jsx)(i.code,{children:"AP"}),", in a similar way to Git.  But new changes can only be appended if you have the latest version of the ledger.  If you append to an out-of-date ledger, your work will be lost."]}),"\n",(0,n.jsxs)(i.p,{children:["Because it's based on outright competition, if someone beats you to completing a mining task, then your work is wasted.  So, there is  ",(0,n.jsx)(i.em,{children:"huge"})," ",(0,n.jsx)(i.a,{href:"/tags/Coordination-Risk",children:"Coordination Risk"}),"."]}),"\n",(0,n.jsxs)(i.p,{children:["For this reason, BTC agents ",(0,n.jsx)(i.a,{href:"/tags/Coordination-Risk",children:"coordinate"})," into ",(0,n.jsx)(i.a,{href:"https://en.bitcoin.it/wiki/Comparison_of_mining_pools",children:"mining consortia"}),", so they can avoid working on the same tasks at the same time, turning it into a ",(0,n.jsx)(i.strong,{children:"CI"}),"-type organisation."]}),"\n",(0,n.jsxs)(i.p,{children:["This in itself is a problem because the whole ",(0,n.jsx)(i.em,{children:"point"})," of BTC is that it's competitive and no one entity has control.  So, mining pools  tend to stop growing before they reach 50% of the BTC network's processing power.  Taking control would be ",(0,n.jsx)(i.a,{href:"https://www.reddit.com/r/Bitcoin/comments/5fe9vz/in_the_last_24hrs_three_mining_pools_have_control/",children:"politically disastrous"})," and confidence in the currency (such as there is) would likely be lost."]}),"\n",(0,n.jsx)(i.h2,{id:"communication-is-for-coordination",children:"Communication Is For Coordination"}),"\n",(0,n.jsxs)(i.p,{children:["CAP theory gives us a fundamental limit on how much ",(0,n.jsx)(i.a,{href:"/tags/Coordination-Risk",children:"Coordination Risk"})," we can mitigate.  We've looked at different organisational structures used to manage ",(0,n.jsx)(i.a,{href:"/tags/Coordination-Risk",children:"Coordination Risk"})," within teams of people, organisations or living organisms, so it's the case in software."]}),"\n",(0,n.jsxs)(i.p,{children:["At the start of this section, we questioned whether ",(0,n.jsx)(i.a,{href:"/tags/Coordination-Risk",children:"Coordination Risk"})," was just another type of ",(0,n.jsx)(i.a,{href:"/tags/Communication-Risk",children:"Communication Risk"}),".  However, it should be clear after looking at the examples of competition, cellular life and Vroom and Yetton's Model that this is exactly ",(0,n.jsx)(i.em,{children:"backwards"}),"."]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Most single-celled life has no need for communication: it simply competes for the available resources.  If it lacks anything it needs, it dies."}),"\n",(0,n.jsxs)(i.li,{children:["There are ",(0,n.jsx)(i.em,{children:"no"})," lines of communication on the ",(0,n.jsx)(i.strong,{children:"UI"})," decision-type.  It's only when we want to avoid competition, by sharing resources and working towards common goals that we need to communicate."]}),"\n",(0,n.jsxs)(i.li,{children:["Therefore, the whole point of communication ",(0,n.jsx)(i.em,{children:"is for coordination"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:["In ",(0,n.jsx)(i.a,{href:"/tags/Internal-Model-Risk",children:"Internal Model Risk"}),", we're going to look at some new ways in which systems can fail, despite their attempts to coordinate."]})]})}function c(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},95052:(e,i,t)=>{t.d(i,{A:()=>s});const s=t.p+"assets/images/cap-ca-4bd440e9414622578467d0d1ad06f922.svg"},95632:(e,i,t)=>{t.d(i,{A:()=>s});const s=t.p+"assets/images/cap1-d5e765b0acb847fb46f6298705efc7e5.svg"}}]);